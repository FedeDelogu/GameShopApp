@using WebAppPlayshphere.DAO
@using Utility
@using WebAppPlayshphere.Models
@model List<Utility.Entity>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <link href="/css/Admin/dashboard.css" rel="stylesheet" />
    <title>Hompage</title>
</head>
<body>
    <div class="container my-5">
        <div class="row shadow rounded-3">
            <div class="bg-side col-3 py-4 px-0 rounded-start-3">
                <div class="d-flex flex-column justify-content-center align-items-center" id="sticky-sidebar">
                    <div class="mb-4">
                        <img src="https://fakeimg.pl/150x150/ffffff/aaaaaa?text=LOGO" alt="Bootstrap" width="64" height="64">
                    </div>
                    <div class="mb-3 w-100 ps-2">
                        <ul class="dropdown-menu d-block position-relative w-100">
                            <li><h6 class="dropdown-header">Gestione Utenti</h6></li>
                            <li><a id="lista-utenti" class="dropdown-item py-2 rounded-start-2" href="#">Lista degli utenti</a></li>
                            <li><a class="dropdown-item py-2 rounded-start-2" href="#">Aggiungi un utente</a></li>
                            <li><a class="dropdown-item py-2 rounded-start-2" href="#">Lista degli utenti bloccati</a></li>
                            <li><a class="dropdown-item py-2 rounded-start-2" href="#">Blocca un utente</a></li>
                        </ul>
                    </div>
                    <div class="mb-3 w-100 ps-2">
                        <ul class="dropdown-menu d-block position-relative w-100">
                            <li><h6 class="dropdown-header">Gestione Prodotti</h6></li>
                            <li><a class="dropdown-item py- 2rounded-start-2" href="#">Lista dei prodotti</a></li>
                            <li><a class="dropdown-item py-2 rounded-start-2" href="#">Aggiungi un prodotto</a></li>
                            <li><a class="dropdown-item py-2 rounded-start-2" href="#">Elimina un prodotto</a></li>
                        </ul>
                    </div>
                    <div class="mb-3 w-100 ps-2">
                        <ul class="dropdown-menu d-block position-relative w-100">
                            <li><h6 class="dropdown-header">Gestione Recensioni</h6></li>
                            <li><a class="dropdown-item py-2 rounded-start-2" href="#">Lista delle recensioni</a></li>
                            <li><a class="dropdown-item py-2 rounded-start-2" href="#">Recensioni in attesa di approvazione</a></li>
                            <li><a class="dropdown-item py-2 rounded-start-2" href="#">Elimina una recensione</a></li>
                        </ul>
                    </div>
                    <div class="mb-3 w-100 ps-2">
                        <ul class="dropdown-menu d-block position-relative w-100">
                            <li><h6 class="dropdown-header">Amministrazione</h6></li>
                            <li><a class="dropdown-item py-2 rounded-start-2" href="#">Modifica del profilo</a></li>
                            <li><a class="dropdown-item py-2 rounded-start-2" href="#">Chat di supporto</a></li>
                        </ul>
                    </div>
                    <div class="mb-3 w-100 d-flex">
                        <button type="button"
                                class="btn btn-primary">
                            <i class="fa-solid fa-right-from-bracket me-1"></i>
                            LOGOUT
                        </button>


                    </div>
                </div>
            </div>
            <div class="col-9 rounded-end-3 main-content  py-4">
                <div id="content-dashboard" class="container">
                   
                </div>
            </div>
        </div>
    </div>
</body>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<script src="https://kit.fontawesome.com/5101093cd6.js" crossorigin="anonymous"></script>

<script>
        
    window.addEventListener('load', function () {
        document.getElementById('lista-utenti').addEventListener('click', function () {
            fetch('/Utenti/ListaUtenti') // Sostituisci ControllerName con il tuo controller
                .then(response => response.json()) // Converte il risultato in JSON
                .then(data => {
                    let content = `<div class="row border-bottom mb-3 ">
                                    <div class="col-1">ID</div>
                                    <div class="col-4">Username</div>
                                    <div class="col-2">Ruolo</div>
                                    <div class="col">Azioni</div>
                                    </div>`;
                    data.forEach(utente => {
                        console.log('Dati ricevuti:', JSON.stringify(data, null, 2));
                        // Crea un ID unico per il modale
                        const modalId = `modal-${utente.id}`;
                        const eliminaId = `elimina-${utente.id}`;

                        content += `<div class="row border-bottom mb-3 py-2">
                        <div class="col-1">${utente.id}</div>
                        <div class="col-4">${utente.username}</div>
                        <div class="col-2">${utente.ruolo === 0 ? "Admin" : "User"}</div>
                        <div class="col">
                            <button type="button" class="btn btn-info" data-bs-toggle="modal" data-bs-target="#${modalId}">
                                Mostra Anagrafica
                            </button>
                                <button type="button" class="btn btn-danger" id="${eliminaId}">
                                    Elimina
                            </button>
                        </div>
                    </div>`;

                        // Aggiungi il modale dinamicamente
                        content += `<div class="modal fade" id="${modalId}" tabindex="-1" aria-labelledby="${modalId}Label" aria-hidden="true">
                            <div class="modal-dialog">
                              <div class="modal-content">
                                <div class="modal-header">
                                  <h1 class="modal-title fs-5" id="${modalId}Label">Anagrafica di ${utente.username}</h1>
                                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    Nome: ${utente.anagrafica?.nome ?? 'Non presente'} <br />
                                    Cognome: ${utente.anagrafica?.cognome ?? 'Non presente'} <br />
                                    Telefono: ${utente.anagrafica?.telefono ?? 'Non presente'} <br />
                                    Anagrafica: ${utente.anagrafica?.citta ?? 'Non presente'} <br />
                                    CAP: ${utente.anagrafica?.cap ?? 'Non presente'} <br />
                                    Stato: ${utente.anagrafica?.stato ?? 'Non presente'} <br />
                                </div>
                                <div class="modal-footer">
                                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Chiudi</button>
                                </div>
                              </div>
                            </div>
                        </div>`;
                    });
                    document.getElementById('content-dashboard').innerHTML = content;
                })
                .catch(error => console.error('Errore:', error));
        });
    });

</script>

</html>